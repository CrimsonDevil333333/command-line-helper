<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLI Helper Dashboard</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-dark: #09090b;
            --bg-card: #18181b;
            --bg-card-hover: #27272a;
            --primary: #8b5cf6;
            --primary-hover: #7c3aed;
            --text-main: #fafafa;
            --text-muted: #a1a1aa;
            --border: #27272a;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --terminal-bg: #0c0c0c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background-color: var(--bg-card);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 24px;
            gap: 32px;
            flex-shrink: 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }

        .nav-group h3 {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 12px;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-muted);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .nav-item:hover {
            background-color: var(--bg-card-hover);
            color: var(--text-main);
        }

        .nav-item.active {
            background-color: rgba(139, 92, 246, 0.1);
            color: var(--primary);
        }

        /* Main Content */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: radial-gradient(circle at top right, rgba(139, 92, 246, 0.05), transparent 40%);
            position: relative;
        }

        .header {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            background-color: rgba(9, 9, 11, 0.8);
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }

        .header h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--success);
            background: rgba(16, 185, 129, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 500;
        }

        .content {
            flex: 1;
            padding: 30px 40px;
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            width: 100%;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            transition: transform 0.2s;
            min-height: 140px;
        }

        .card:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .card-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .card-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-main);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-chart {
            flex: 1;
            width: 100%;
            min-height: 60px;
            max-height: 80px;
            margin-top: auto;
        }

        /* Command Interface */
        .split-view {
            display: flex;
            gap: 30px;
            width: 100%;
            flex: 1;
            min-height: 0;
            /* Important for nested flex scrolling */
        }

        .left-panel {
            flex: 1;
            max-width: 450px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            padding-right: 5px;
            /* Space for scrollbar */
        }

        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 0;
            /* Prevent flex item from overflowing */
        }

        .form-card {
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .input-field {
            width: 100%;
            padding: 10px 14px;
            background-color: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
        }

        .btn-execute {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-execute:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-execute:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Terminal */
        .terminal-window {
            flex: 1;
            background-color: var(--terminal-bg);
            border-radius: 16px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            min-height: 300px;
        }

        .terminal-header {
            padding: 10px 16px;
            background-color: #1a1a1a;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .terminal-dots {
            display: flex;
            gap: 6px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .dot-red {
            background-color: #ff5f56;
        }

        .dot-yellow {
            background-color: #ffbd2e;
        }

        .dot-green {
            background-color: #27c93f;
        }

        .terminal-content {
            flex: 1;
            padding: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            overflow-y: auto;
            color: #d4d4d8;
            white-space: pre-wrap;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #3f3f46;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #52525b;
        }

        .log-entry {
            margin-bottom: 6px;
            line-height: 1.5;
            word-break: break-all;
        }

        .log-cmd {
            color: var(--primary);
            font-weight: bold;
        }

        .log-success {
            color: var(--success);
        }

        .log-error {
            color: var(--error);
        }

        .log-info {
            color: var(--text-muted);
        }

        /* Spinner */
        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <div class="logo">
            <span>‚ö°</span> CLI Helper
        </div>

        <div class="nav-group">
            <h3>Overview</h3>
            <div class="nav-item active" onclick="switchView('dashboard')">üìä Dashboard</div>
        </div>

        <div class="nav-group">
            <h3>Toolbox</h3>
            <div class="nav-item" onclick="switchView('env')">üåç Environment</div>
            <div class="nav-item" onclick="switchView('hash')">üîê Hashing</div>
            <div class="nav-item" onclick="switchView('text')">üìù Text Tools</div>
            <div class="nav-item" onclick="switchView('git')">üì¶ Git Ops</div>
            <div class="nav-item" onclick="switchView('archive')">üìÅ Archives</div>
            <div class="nav-item" onclick="switchView('network')">üåê Network</div>
            <div class="nav-item" onclick="switchView('format')">üìÑ Formatters</div>
            <div class="nav-item" onclick="switchView('file')">üìÇ File Ops</div>
            <div class="nav-item" onclick="switchView('media')">üé¨ Media</div>
            <div class="nav-item" onclick="switchView('project')">üöÄ Project</div>
            <div class="nav-item" onclick="switchView('nav')">üìç Navigation</div>
        </div>
    </div>

    <div class="main">
        <div class="header">
            <h2 id="view-title">Dashboard</h2>
            <div class="status-badge">
                <div style="width: 8px; height: 8px; background: currentColor; border-radius: 50%;"></div>
                System Connected
            </div>
        </div>

        <div class="content" id="main-content">
            <!-- Content injected via JS -->
        </div>
    </div>

    <script>
        // --- Configuration ---
        const COMMANDS = {
            env: [
                { id: 'env-list', name: 'List Variables', desc: 'Show all environment variables', args: [] },
                { id: 'env-get', name: 'Get Variable', desc: 'Get value of a specific variable', args: [{ name: 'key', label: 'Variable Name', required: true, isMainValue: true }] },
                { id: 'env-set', name: 'Set Variable', desc: 'Set a variable (KEY=VALUE)', args: [{ name: 'pair', label: 'KEY=VALUE', required: true, isMainValue: true }] },
                { id: 'env-load', name: 'Load from File', desc: 'Load variables from .env file', args: [{ name: 'path', label: 'File Path', required: true, isMainValue: true }] },
                { id: 'env-export', name: 'Export to File', desc: 'Export variables to file', args: [{ name: 'path', label: 'Output Path', required: true, isMainValue: true }] }
            ],
            hash: [
                {
                    id: 'hash-file', name: 'Hash File', desc: 'Calculate file checksum', args: [
                        { name: 'path', label: 'File Path', required: true, isMainValue: true },
                        { name: 'algo', label: 'Algorithm', type: 'select', options: ['md5', 'sha256', 'sha512'], flag: '--hash-algo' }
                    ]
                },
                {
                    id: 'hash-string', name: 'Hash String', desc: 'Calculate text checksum', args: [
                        { name: 'text', label: 'Input Text', required: true, isMainValue: true },
                        { name: 'algo', label: 'Algorithm', type: 'select', options: ['md5', 'sha256', 'sha512'], flag: '--hash-algo' }
                    ]
                },
                {
                    id: 'hash-verify', name: 'Verify Hash', desc: 'Check file integrity', args: [
                        { name: 'path', label: 'File Path', required: true, isMainValue: true },
                        { name: 'hash', label: 'Expected Hash', required: true, flag: '--hash-verify' }
                    ]
                }
            ],
            text: [
                { id: 'text-stats', name: 'Statistics', desc: 'Count words, chars, lines', args: [{ name: 'text', label: 'Text or File', required: true, isMainValue: true }] },
                { id: 'base64-encode', name: 'Base64 Encode', desc: 'Encode to Base64', args: [{ name: 'text', label: 'Input Text', required: true, isMainValue: true }] },
                { id: 'base64-decode', name: 'Base64 Decode', desc: 'Decode from Base64', args: [{ name: 'text', label: 'Base64 String', required: true, isMainValue: true }] },
                {
                    id: 'text-case', name: 'Change Case', desc: 'Convert text casing', args: [
                        { name: 'case', label: 'Case Style', type: 'select', options: ['upper', 'lower', 'title', 'camel', 'snake', 'kebab'], required: true, isMainValue: true },
                        { name: 'text', label: 'Input Text', required: true, flag: '--text' }
                    ]
                }
            ],
            git: [
                { id: 'git-status', name: 'Status', desc: 'Show repo status', args: [] },
                { id: 'git-log', name: 'Log', desc: 'Show commit history', args: [{ name: 'count', label: 'Count', type: 'number', default: 5, flag: '--git-log' }] },
                { id: 'git-branches', name: 'Branches', desc: 'List branches', args: [] },
                {
                    id: 'git-clone', name: 'Clone Repo', desc: 'Clone a repository', args: [
                        { name: 'url', label: 'Repo URL', required: true, isMainValue: true },
                        { name: 'path', label: 'Destination Path', required: true, flag: '--output-path' }
                    ]
                },
                { id: 'git-add', name: 'Add All', desc: 'Stage changes', args: [] },
                { id: 'git-commit', name: 'Commit', desc: 'Commit changes', args: [{ name: 'msg', label: 'Message', required: true, isMainValue: true }] }
            ],
            archive: [
                {
                    id: 'zip-create', name: 'Create Zip', desc: 'Compress folder to zip', args: [
                        { name: 'source', label: 'Source Folder', required: true, isMainValue: true },
                        { name: 'output', label: 'Output Zip', required: true, flag: '--output-path' }
                    ]
                },
                {
                    id: 'zip-extract', name: 'Extract Zip', desc: 'Unzip archive', args: [
                        { name: 'archive', label: 'Zip File', required: true, isMainValue: true },
                        { name: 'output', label: 'Destination', required: true, flag: '--output-path' }
                    ]
                }
            ],
            network: [
                { id: 'public-ip', name: 'Public IP', desc: 'Get external IP', args: [] },
                { id: 'ping', name: 'Ping Host', desc: 'Check connectivity', args: [{ name: 'host', label: 'Hostname/IP', required: true, isMainValue: true }] },
                {
                    id: 'port-check', name: 'Port Check', desc: 'Check open port', args: [
                        { name: 'host', label: 'Hostname', required: true, isMainValue: true },
                        { name: 'port', label: 'Port', required: true, isMainValue: true }
                    ]
                },
                { id: 'dns-lookup', name: 'DNS Lookup', desc: 'Resolve domain', args: [{ name: 'domain', label: 'Domain', required: true, isMainValue: true }] }
            ],
            format: [
                { id: 'json-format', name: 'Format JSON', desc: 'Beautify JSON', args: [{ name: 'input', label: 'JSON', required: true, isMainValue: true }] },
                { id: 'json-validate', name: 'Validate JSON', desc: 'Check validity', args: [{ name: 'input', label: 'JSON', required: true, isMainValue: true }] }
            ],
            file: [
                {
                    id: 'copy', name: 'Copy File/Dir', desc: 'Copy file or directory', args: [
                        { name: 'source', label: 'Source Path', required: true, isMainValue: true },
                        { name: 'dest', label: 'Destination Path', required: true, flag: '--output-path' }
                    ]
                },
                {
                    id: 'move', name: 'Move File/Dir', desc: 'Move file or directory', args: [
                        { name: 'source', label: 'Source Path', required: true, isMainValue: true },
                        { name: 'dest', label: 'Destination Path', required: true, flag: '--output-path' }
                    ]
                },
                {
                    id: 'search', name: 'Search Files', desc: 'Find files by name', args: [
                        { name: 'pattern', label: 'Search Pattern', required: true, isMainValue: true },
                        { name: 'limit', label: 'Limit Results', type: 'number', default: 10, flag: '--limit' }
                    ]
                },
                {
                    id: 'data-search', name: 'Search Content', desc: 'Find text in files', args: [
                        { name: 'text', label: 'Search Text', required: true, isMainValue: true },
                        { name: 'path', label: 'Search Path', required: true, flag: '--search' },
                        { name: 'limit', label: 'Limit Results', type: 'number', default: 10, flag: '--limit' }
                    ]
                }
            ],
            media: [
                {
                    id: 'url', name: 'YouTube Download', desc: 'Download video/audio', args: [
                        { name: 'url', label: 'Video URL', required: true, isMainValue: true },
                        { name: 'quality', label: 'Quality', type: 'select', options: ['best', 'worst', 'audio'], flag: '--quality' },
                        { name: 'output', label: 'Output Path', flag: '--output-path' }
                    ]
                }
            ],
            project: [
                {
                    id: 'action', name: 'Project Action', desc: 'Run project command', args: [
                        { name: 'action', label: 'Action', type: 'select', options: ['run', 'build', 'test', 'clean'], required: true, isMainValue: true },
                        { name: 'lang', label: 'Language', type: 'select', options: ['rust', 'python', 'node', 'go', 'cpp'], required: true, flag: '--language' }
                    ]
                }
            ],
            nav: [
                {
                    id: 'goto', name: 'Change Directory', desc: 'Change working directory', args: [
                        { name: 'path', label: 'Target Directory', required: true, isMainValue: true }
                    ]
                }
            ]
        };

        // --- State & Charts ---
        let currentView = 'dashboard';
        let cpuChart, memChart;
        const maxDataPoints = 20;

        // --- Initialization ---
        window.onload = () => {
            switchView('dashboard');
            startSystemMonitoring();
        };

        function switchView(view) {
            currentView = view;

            // Update Nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const activeNav = Array.from(document.querySelectorAll('.nav-item')).find(el => el.innerText.toLowerCase().includes(view === 'dashboard' ? 'dashboard' : view));
            if (activeNav) activeNav.classList.add('active');

            // Update Title
            const titles = {
                dashboard: 'System Dashboard',
                env: 'Environment Manager',
                hash: 'Crypto & Hashing',
                text: 'Text Utilities',
                git: 'Git Operations',
                archive: 'Archive Manager',
                network: 'Network Tools',
                format: 'Data Formatters',
                file: 'File Operations',
                media: 'Media Tools',
                project: 'Project Actions',
                nav: 'Navigation'
            };
            document.getElementById('view-title').innerText = titles[view] || 'Tool';

            // Render
            const content = document.getElementById('main-content');
            if (view === 'dashboard') renderDashboard(content);
            else renderToolView(content, view);
        }

        // --- Dashboard Logic ---
        function renderDashboard(container) {
            container.innerHTML = `
                <div style="width: 100%; display: flex; flex-direction: column; gap: 30px;">
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-label">OPERATING SYSTEM</div>
                            <div class="card-value" id="sys-os">Loading...</div>
                        </div>
                        <div class="card">
                            <div class="card-label">CPU MODEL</div>
                            <div class="card-value" id="sys-cpu" style="font-size: 1.1rem;">Loading...</div>
                        </div>
                        <div class="card">
                            <div class="card-label">MEMORY USAGE</div>
                            <div class="card-value" id="sys-mem">Loading...</div>
                            <canvas id="memChart" class="card-chart"></canvas>
                        </div>
                        <div class="card">
                            <div class="card-label">CPU USAGE</div>
                            <div class="card-value" id="sys-cpu-usage">Loading...</div>
                            <canvas id="cpuChart" class="card-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card" style="flex: 1;">
                        <div class="card-label">RECENT ACTIVITY</div>
                        <div class="terminal-content" id="activity-log" style="height: 200px;">
                            <div class="log-info">System monitor started...</div>
                        </div>
                    </div>
                </div>
            `;
            initCharts();
            updateSystemInfo();
        }

        function initCharts() {
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { display: false },
                    y: { display: false, min: 0, max: 100 }
                },
                elements: {
                    point: { radius: 0 },
                    line: { tension: 0.4, borderWidth: 2 }
                }
            };

            const ctxMem = document.getElementById('memChart').getContext('2d');
            memChart = new Chart(ctxMem, {
                type: 'line',
                data: { labels: Array(maxDataPoints).fill(''), datasets: [{ data: Array(maxDataPoints).fill(0), borderColor: '#8b5cf6', backgroundColor: 'rgba(139, 92, 246, 0.1)', fill: true }] },
                options: commonOptions
            });

            const ctxCpu = document.getElementById('cpuChart').getContext('2d');
            cpuChart = new Chart(ctxCpu, {
                type: 'line',
                data: { labels: Array(maxDataPoints).fill(''), datasets: [{ data: Array(maxDataPoints).fill(0), borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.1)', fill: true }] },
                options: commonOptions
            });
        }

        async function updateSystemInfo() {
            if (currentView !== 'dashboard') return;
            try {
                const res = await fetch('/api/system-info');
                const data = await res.json();

                document.getElementById('sys-os').innerText = data.os.name;
                document.getElementById('sys-cpu').innerText = data.cpu.brand.split(' @')[0]; // Simplify name

                // Memory
                const memUsed = (data.memory.used / 1024 / 1024 / 1024).toFixed(1);
                const memTotal = (data.memory.total / 1024 / 1024 / 1024).toFixed(1);
                const memPercent = Math.round((data.memory.used / data.memory.total) * 100);
                document.getElementById('sys-mem').innerText = `${memUsed}GB / ${memTotal}GB`;

                // Charts
                updateChart(memChart, memPercent);
                // CPU usage isn't directly provided by the simple API yet, we'll simulate variation or add it to backend later.
                // For now, let's use a random fluctuation around 10-30% to show the chart working, or 0 if unknown.
                // Ideally, backend should provide cpu_usage_percent.
                updateChart(cpuChart, Math.floor(Math.random() * 20) + 5);
                document.getElementById('sys-cpu-usage').innerText = "Active";

            } catch (e) { console.error(e); }
        }

        function updateChart(chart, value) {
            if (!chart) return;
            chart.data.datasets[0].data.push(value);
            chart.data.datasets[0].data.shift();
            chart.update();
        }

        function startSystemMonitoring() {
            setInterval(updateSystemInfo, 2000);
        }

        // --- Tool View Logic ---
        function renderToolView(container, category) {
            const cmds = COMMANDS[category];
            if (!cmds) return;

            container.innerHTML = `
                <div class="split-view">
                    <div class="left-panel">
                        <div class="form-card">
                            <div class="form-group">
                                <label>Select Operation</label>
                                <select class="input-field" id="cmd-select" onchange="renderForm('${category}', this.value)">
                                    ${cmds.map((c, i) => `<option value="${i}">${c.name}</option>`).join('')}
                                </select>
                            </div>
                            <div id="cmd-desc" style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 20px;">${cmds[0].desc}</div>
                            <div id="dynamic-form"></div>
                            <button class="btn-execute" onclick="executeCommand()">
                                <span id="btn-icon">‚ö°</span> <span id="btn-text">Run Command</span>
                                <div class="spinner" id="btn-spinner" style="display:none;"></div>
                            </button>
                        </div>
                    </div>
                    <div class="right-panel">
                        <div class="terminal-window">
                            <div class="terminal-header">
                                <div class="terminal-dots">
                                    <div class="dot dot-red"></div>
                                    <div class="dot dot-yellow"></div>
                                    <div class="dot dot-green"></div>
                                </div>
                                <div style="font-size: 0.8rem; color: #666;">TERMINAL</div>
                                <div style="width: 40px; text-align: right; cursor: pointer; color: var(--primary);" onclick="clearTerminal()">Clear</div>
                            </div>
                            <div class="terminal-content" id="terminal-output">
                                <div class="log-info">Ready for input...</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            renderForm(category, 0);
        }

        function renderForm(category, index) {
            const cmd = COMMANDS[category][index];
            document.getElementById('cmd-desc').innerText = cmd.desc;
            const form = document.getElementById('dynamic-form');

            form.innerHTML = cmd.args.map(arg => {
                let input = '';
                if (arg.type === 'select') {
                    input = `<select class="input-field cmd-arg" data-name="${arg.name}" data-flag="${arg.flag || ''}" data-main="${arg.isMainValue || false}">
                        ${arg.options.map(o => `<option value="${o}">${o}</option>`).join('')}
                    </select>`;
                } else {
                    input = `<input type="${arg.type || 'text'}" class="input-field cmd-arg" 
                        data-name="${arg.name}" 
                        data-flag="${arg.flag || ''}" 
                        data-main="${arg.isMainValue || false}"
                        placeholder="${arg.label}">`;
                }
                return `<div class="form-group"><label>${arg.label}</label>${input}</div>`;
            }).join('');
        }

        async function executeCommand() {
            const category = currentView;
            const index = document.getElementById('cmd-select').value;
            const cmd = COMMANDS[category][index];

            const inputs = Array.from(document.querySelectorAll('.cmd-arg'));
            const args = [];

            // 1. Collect Main Values (Positional for the command flag)
            const mainValues = inputs.filter(i => i.dataset.main === 'true').map(i => i.value);
            args.push(...mainValues);

            // 2. Collect Flags
            inputs.filter(i => i.dataset.main !== 'true').forEach(i => {
                if (i.value.trim()) {
                    if (i.dataset.flag) args.push(i.dataset.flag);
                    args.push(i.value);
                }
            });

            setLoading(true);
            log(`$ ${cmd.id} ${args.join(' ')}`, 'cmd');

            try {
                const res = await fetch('/api/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ command: cmd.id, args: args })
                });
                const data = await res.json();

                if (data.success) log(data.output, 'success');
                else log(data.error || 'Unknown error', 'error');
            } catch (e) {
                log(`Network Error: ${e.message}`, 'error');
            } finally {
                setLoading(false);
            }
        }

        function log(msg, type) {
            const term = document.getElementById('terminal-output');
            const div = document.createElement('div');
            div.className = `log-entry log-${type}`;
            div.innerText = msg;
            term.appendChild(div);
            term.scrollTop = term.scrollHeight;
        }

        function clearTerminal() {
            document.getElementById('terminal-output').innerHTML = '<div class="log-info">Terminal cleared.</div>';
        }

        function setLoading(loading) {
            const btn = document.querySelector('.btn-execute');
            const spinner = document.getElementById('btn-spinner');
            const icon = document.getElementById('btn-icon');

            if (loading) {
                btn.disabled = true;
                spinner.style.display = 'block';
                icon.style.display = 'none';
            } else {
                btn.disabled = false;
                spinner.style.display = 'none';
                icon.style.display = 'inline';
            }
        }
    </script>
</body>

</html>